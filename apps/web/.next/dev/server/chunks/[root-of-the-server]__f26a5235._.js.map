{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["C:/Users/Adoonl/Desktop/triviaNFT/apps/web/app/api/health/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\n\r\n/**\r\n * Health check endpoint\r\n * Returns status of critical services and environment configuration\r\n */\r\n\r\ninterface HealthStatus {\r\n  status: 'healthy' | 'degraded' | 'unhealthy';\r\n  timestamp: string;\r\n  environment: string;\r\n  checks: {\r\n    database: boolean;\r\n    redis: boolean;\r\n    inngest: boolean;\r\n    envVars: {\r\n      configured: string[];\r\n      missing: string[];\r\n    };\r\n  };\r\n}\r\n\r\nconst REQUIRED_ENV_VARS = [\r\n  'DATABASE_URL',\r\n  'REDIS_URL',\r\n  'REDIS_TOKEN',\r\n  'INNGEST_EVENT_KEY',\r\n  'INNGEST_SIGNING_KEY',\r\n  'BLOCKFROST_PROJECT_ID',\r\n  'NFT_POLICY_ID',\r\n  'JWT_SECRET',\r\n  'JWT_ISSUER',\r\n];\r\n\r\nexport async function GET() {\r\n  try {\r\n    // Check environment variables\r\n    const configured: string[] = [];\r\n    const missing: string[] = [];\r\n\r\n    REQUIRED_ENV_VARS.forEach(varName => {\r\n      if (process.env[varName]) {\r\n        configured.push(varName);\r\n      } else {\r\n        missing.push(varName);\r\n      }\r\n    });\r\n\r\n    // Check database connection\r\n    let databaseHealthy = false;\r\n    try {\r\n      // Import from services/api database connection\r\n      const { healthCheck } = await import('../../../../../services/api/src/db/connection');\r\n      databaseHealthy = await healthCheck();\r\n    } catch (error) {\r\n      console.error('Database health check failed:', error);\r\n    }\r\n\r\n    // Check Redis connection\r\n    let redisHealthy = false;\r\n    try {\r\n      // Redis health check - for now just check if env vars are present\r\n      // Full Redis integration will be tested separately\r\n      redisHealthy = !!(process.env.REDIS_URL && process.env.REDIS_TOKEN);\r\n    } catch (error) {\r\n      console.error('Redis health check failed:', error);\r\n    }\r\n\r\n    // Check Inngest configuration\r\n    const inngestHealthy = !!(\r\n      process.env.INNGEST_EVENT_KEY && \r\n      process.env.INNGEST_SIGNING_KEY\r\n    );\r\n\r\n    // Determine overall status\r\n    const allEnvVarsPresent = missing.length === 0;\r\n    const allServicesHealthy = databaseHealthy && redisHealthy && inngestHealthy;\r\n\r\n    let status: 'healthy' | 'degraded' | 'unhealthy';\r\n    if (allEnvVarsPresent && allServicesHealthy) {\r\n      status = 'healthy';\r\n    } else if (allEnvVarsPresent || (databaseHealthy && redisHealthy)) {\r\n      status = 'degraded';\r\n    } else {\r\n      status = 'unhealthy';\r\n    }\r\n\r\n    const healthStatus: HealthStatus = {\r\n      status,\r\n      timestamp: new Date().toISOString(),\r\n      environment: process.env.VERCEL_ENV || process.env.NODE_ENV || 'unknown',\r\n      checks: {\r\n        database: databaseHealthy,\r\n        redis: redisHealthy,\r\n        inngest: inngestHealthy,\r\n        envVars: {\r\n          configured,\r\n          missing,\r\n        },\r\n      },\r\n    };\r\n\r\n    const statusCode = status === 'healthy' ? 200 : status === 'degraded' ? 200 : 503;\r\n\r\n    return NextResponse.json(healthStatus, { status: statusCode });\r\n  } catch (error) {\r\n    console.error('Health check error:', error);\r\n    return NextResponse.json(\r\n      {\r\n        status: 'unhealthy',\r\n        timestamp: new Date().toISOString(),\r\n        error: error instanceof Error ? error.message : 'Unknown error',\r\n      },\r\n      { status: 503 }\r\n    );\r\n  }\r\n}\r\n"],"names":["NextResponse","REQUIRED_ENV_VARS","GET","_GET","apply","arguments","_asyncToGenerator","configured","missing","forEach","varName","process","env","push","databaseHealthy","_yield$import","healthCheck","error","console","redisHealthy","REDIS_URL","REDIS_TOKEN","inngestHealthy","INNGEST_EVENT_KEY","INNGEST_SIGNING_KEY","allEnvVarsPresent","length","allServicesHealthy","status","healthStatus","timestamp","Date","toISOString","environment","VERCEL_ENV","NODE_ENV","checks","database","redis","inngest","envVars","statusCode","json","Error","message"],"mappings":"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","ignoreList":[]}}]
}